{
  "nodes": [
    {
      "parameters": {
        "inputSource": "jsonExample",
        "jsonExample": "{\n  \"Pergunta\": \"\",\n  \"seasonID\": \"\"\n}"
      },
      "id": "03b87912-370f-466a-b1ce-bdd489e9251d",
      "typeVersion": 1.1,
      "name": "When Executed by Another Workflow",
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "position": [
        -608,
        192
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.Pergunta }}",
        "options": {
          "systemMessage": "=<agent name=\"AgenteHandoffVendedores\" domain=\"Shineray Belem\">\n  <identity>\n    Voc√™ √© o Agente Handoff & Vendedores da concession√°ria Shineray Bel√©m. \n    Seu papel √© fazer a transi√ß√£o do atendimento automatizado para o time humano de vendas, garantindo que o cliente seja recebido com aten√ß√£o e sem perder informa√ß√µes importantes.\n    O telefone do usu√°rio √© {{ $json.Telefone }}\n  </identity>\n\n  <objectives>\n    <item>Confirmar com o cliente que um vendedor humano ir√° assumir a conversa em breve.</item>\n    <item>Coletar dados essenciais antes da transfer√™ncia: nome completo, telefone, modelo de interesse e melhor hor√°rio para contato.</item>\n    <item>Passar ao vendedor humano um resumo organizado do atendimento.</item>\n    <item>Transmitir seguran√ßa ao cliente de que ele ser√° atendido pessoalmente.</item>\n    <item>Se necess√°rio, reforce o interesse do cliente ativando a tool  <tool>contatarVendedor</tool> mais de uma vez. Inclua na mensagem novas informa√ß√µes que o cliente tenha falado durante a conversa chamando novamente o atendente humano com a tool <tool>contatarVendedor</tool>.</item>\n    <item>*CASO ESSA MENSAGEM SEJA UM CONTATO DE UM NOVO INTERESSADO, INCLUA \"‚ùáÔ∏èNOVO INTERESSADO‚ùáÔ∏è\" NO TOPO DA MENSAGEM*</item>\n    <item>*CASO ESSA MENSAGEM SEJA UM REFOR√áO DE UMA MENSAGEM QUE VOC√ä J√Å ENVIOU PARA OS VENDEDORES, INCLUA \"üî¥MENSAGEM DE REFOR√áOüî¥\" NO TOPO DA MENSAGEM*</item>\n  </objectives>\n\n  <rules>\n    <rule>Sempre confirme com o cliente: ‚ÄúUm de nossos vendedores j√° vai entrar em contato com voc√™ para finalizar os detalhes. Pode me confirmar seu nome completo e n√∫mero de telefone para agilizarmos?‚Äù</rule>\n    <rule>Se o cliente j√° forneceu alguns dados antes, apenas confirme e complete as informa√ß√µes faltantes.</rule>\n    <rule>Nunca responda d√∫vidas t√©cnicas ou financeiras ‚Äî apenas fa√ßa a transi√ß√£o para o time humano.</rule>\n    <rule>Finalize sempre com uma frase de direcionamento positivo, como ‚ÄúNosso vendedor j√° vai te atender, pode ficar tranquilo.‚Äù</rule>\n  </rules>\n\n  <handoff trigger=\"lead_qualificado\">\n    <message>\n      Vou repassar suas informa√ß√µes ao nosso time de vendas, que j√° vai assumir o atendimento com voc√™. \n      Assim garantimos que voc√™ seja atendido de forma personalizada. üöÄ\n    </message>\n  </handoff>\n\n  <conversationFlow>\n    <example id=\"coleta\">\n      <user>Quero fechar a compra dessa moto.</user>\n      <assistant>\n        Excelente not√≠cia! üéâ Um de nossos vendedores vai falar com voc√™ para finalizar os detalhes.  \n        Pode me confirmar seu **nome completo** e **telefone** para agilizar o atendimento?\n      </assistant>\n    </example>\n\n    <example id=\"dados\">\n      <user>Meu nome √© Jo√£o Silva, n√∫mero (91) 99999-8888.</user>\n      <assistant>\n        Perfeito, Jo√£o! ‚úÖ  \n        E s√≥ para confirmar: voc√™ est√° interessado no modelo **SHI 175**, correto?  \n        Nosso time de vendas j√° vai entrar em contato com voc√™ em breve.\n      </assistant>\n    </example>\n  </conversationFlow>\n\n  <tone>\n    Cordial, confi√°vel e organizado.  \n    O cliente deve sentir que agora ser√° cuidado pessoalmente por um vendedor da Shineray Bel√©m.  \n  </tone>\n</agent>\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        -400,
        192
      ],
      "id": "",
      "name": "Handoff & Vendedores"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -400,
        368
      ],
      "id": "",
      "name": "OpenAI Chat Model3",
      "credentials": {
        "openAiApi": {
          "id": "",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $json.seasonID }}",
        "contextWindowLength": 10
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        -304,
        368
      ],
      "id": "58018466-0290-4de6-a9e5-d3f4e31d7b46",
      "name": "Window Buffer Memory1"
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "Use essa tool para contatar o vendedor humano. *CASO ESSA MENSAGEM SEJA UM REFOR√áO DE UMA MENSAGEM QUE VOC√ä J√Å ENVIOU PARA OS VENDEDORES, INCLUA \"üî¥MENSAGEM DE REFOR√áOüî¥\" NO TOPO DA MENSAGEM*",
        "text": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Text', `Essa √© uma mensagem com todas as informa√ß√µes coletadas durante a conversa. Ela ser√° encaminhada para o vendedor Humano.\n\nA mensagem pode ser do tipo:\nCliente [NOME DO CLIENTE] manifestou interesse em adquirir uma moto. \nüë§Nome: [NOME DO CLIENTE] \nüèçÔ∏èModelo: [NOME DO MODELO DE INTERESSE] \nüìûTelefone: [TELEFONE DO CLIENTE]. \n‚åöMelhor hor√°rio para contato: [HORARIO DE PREFERENCIA DO CLIENTE] .\nObs: [Informa√ß√µes que voc√™ ache importante destacar para o vendedor humano. Tipo temperamento do cliente, humor, dificuldades do cliente, curiosidade sobre a pessoa, qualquer coisa que ajude o ainda mais o vendedor a atende-lo de maneira certa e fechar a venda]\n\n*CASO ESSA MENSAGEM SEJA UM REFOR√áO DE UMA MENSAGEM QUE VOC√ä J√Å ENVIOU PARA OS VENDEDORES, INCLUA \"üî¥MENSAGEM DE REFOR√áOüî¥\" NO TOPO DA MENSAGEM*\n`, 'string') }}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegramTool",
      "typeVersion": 1.2,
      "position": [
        -208,
        368
      ],
      "id": "",
      "name": "contatarVendedor",
      "webhookId": "",
      "credentials": {
        "telegramApi": {
          "id": "qFglO78HLYiSoN2H",
          "name": "Telegram account 2"
        }
      }
    },
    {
      "parameters": {
        "content": "## Importante\n- Colocar a vari√°vel do contato do cliente antes de mandar para o time de vendedores.\n- Refinar o formato de mensagem."
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -400,
        -16
      ],
      "typeVersion": 1,
      "id": "9468e58f-67c6-4765-9f0c-9acf916e13bf",
      "name": "Sticky Note"
    }
  ],
  "connections": {
    "When Executed by Another Workflow": {
      "main": [
        [
          {
            "node": "Handoff & Vendedores",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model3": {
      "ai_languageModel": [
        [
          {
            "node": "Handoff & Vendedores",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Window Buffer Memory1": {
      "ai_memory": [
        [
          {
            "node": "Handoff & Vendedores",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "contatarVendedor": {
      "ai_tool": [
        [
          {
            "node": "Handoff & Vendedores",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {
    "When Executed by Another Workflow": [
      {
        "Pergunta": "posso falar com um vendedor?",
        "seasonID": "11bcbeca0167414082a4676f7c310fde"
      }
    ]
  },
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "c9a039713f257ec3ef724f71164f951e9c35d9b89dce2a3492cb1f204a2b86c2"
  }
}
